<!DOCTYPE html>
<html>
<head>
  <title>RanTreker Admin - List of Members</title>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/members.css">
  <script src="/js/members.js" defer></script>
</head>
<body>

  <div class="sidebar">
    <div class="logo">
      <img src="/img/RanTreker Logo.png" alt="RANTREKER Logo"> 
    </div>
    <br><br> 
    <div class="menu">
      <a th:href="@{/admin/members}"class="active">Members</a>
      <a th:href="@{/admin/races}" class="inactive">Races</a>
      <a th:href="@{/admin/addRace}" class="inactive">Add Race</a>
      <a th:href="@{/logout}" class="inactive">Logout</a>
    </div>
  </div>

  <div class="content">
    <div class="container"> 
      <h1>Members</h1> 

      <form th:action="@{/admin/members}" method="GET">
        <p style="font-weight: bold;">Search</p>
        <div class="search-box">
          <input type="text" name="name" id="name" placeholder="Search member by name" th:value="${name}">
        </div>

        <p style="font-weight: bold;">Filters</p>
        <div class="filter-box">

          <div class="filter-items">
            <label for="nameSort">Name:</label>
            <select id="nameSort" name="nameSort" onchange="this.form.submit()">
              <option value="ASC" th:selected="${nameSort == 'ASC'}">Ascending</option>
              <option value="DESC" th:selected="${nameSort == 'DESC'}">Descending</option>
            </select>
          </div>

          <div class="filter-items">
            <label for="peran">Role:</label>
            <select id="peran" name="peran" onchange="this.form.submit()">
              <option value="None" th:selected="${peran == 'None'}">-- Select role --</option>
              <option value="user" th:selected="${peran == 'user'}">User</option>
              <option value="admin" th:selected="${peran == 'admin'}">Admin</option>
            </select>
          </div>
        </div>
      </form>

      <div id="confirmationModal">
        <div id="confirmationContents">
          <h3 style="color: #fc4c02;">Are you sure you want to delete this user?</h3>
          <div id="confirmationButtons">
            <button id="confirmDeleteButton"
              style="background-color: #fc4c02; color: white; ">Yes</button>
            <button onclick="closeModal()"
              style="background-color: #ccc; color: black;">No</button>
          </div>
        </div>
      </div>

      <h2 th:text="${totalUser} +  ' Members'"></h2> 

      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Email</th>
            <th>Role</th>
            <th>Actions</th> 
          </tr>
        </thead>
        <tbody>
          <tr th:each="user, stat : ${users}">
            <td th:text="${stat.index + 1} + '.'"></td>
            <td th:text="${user.name}"></td> 
            <td th:text="${user.email}"></td>
            <td th:text="${user.peran}"></td>
            <td>
              <a th:href="@{/admin/editMember(id=${user.id_user})}" class="action-link">Edit</a>
              <a class="delete-link" th:onclick="confirmDelete([[${user.id_user}]])">Delete</a>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
      <div th:if="${totalPages > 1}">
        <nav>
            <ul class="pagination-container">
                <li>
                    <a th:href="@{/admin/members(page=${currentPage > 1 ? currentPage - 1 : 1}, name=${name}, nameSort=${nameSort}, peran=${peran})}" 
                      aria-label="Previous" 
                      th:class="${currentPage == 1} ? 'disabled' : null">
                        &laquo;
                    </a>
                </li>
    
                <!-- Tombol Halaman -->
                <li th:each="i : ${#numbers.sequence(1, totalPages)}">
                    <a th:href="@{/admin/members(page=${i}, name=${name}, nameSort=${nameSort}, peran=${peran})}" 
                      th:text="${i}" 
                      th:class="${currentPage == i} ? 'active' : null"></a>
                </li>
    
                <!-- Tombol Next -->
                <li>
                    <a th:href="@{/admin/members(page=${currentPage < totalPages ? currentPage + 1 : totalPages}, name=${name}, nameSort=${nameSort}, peran=${peran})}" 
                      aria-label="Next" 
                      th:class="${currentPage == totalPages} ? 'disabled' : null">
                        &raquo;
                    </a>
                </li>
            </ul>
        </nav>
    </div>
    
  </div>

</body>
</html>